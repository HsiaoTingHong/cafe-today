"use strict";(self["webpackChunkcafe_today"]=self["webpackChunkcafe_today"]||[]).push([[699],{7258:function(e,t,a){a.d(t,{A:function(){return s}});var l=a(144);function s(e){const t=(0,l.KR)(!1),a=(0,l.KR)(!1),s=(0,l.KR)(""),o=function(e){return new Promise((t=>{setTimeout((()=>{console.log(`已等待 ${e} 毫秒`),t()}),e)}))},n=async function(){t.value=!0,a.value=!1,s.value="";try{await o(3e3);const t=Math.floor(Math.random()*e.value.length);s.value=e.value[t],a.value=!0}catch(l){console.error("抽籤過程發生錯誤:",l)}finally{t.value=!1}};return{selectedShop:s,isDestiny:t,isDestinyDone:a,getDestinyShop:n}}},5785:function(e,t,a){a.d(t,{A:function(){return s}});var l=a(144);function s(){const e=(0,l.KR)(!1),t=(0,l.KR)(""),a=(0,l.KR)("success"),s=(l,s="success")=>{t.value=l,a.value=s,e.value=!0},o=()=>{e.value=!1};return{showModal:e,modalMessage:t,modalType:a,openModal:s,closeModal:o}}},3998:function(e,t,a){a.d(t,{A:function(){return p}});a(8992),a(3949);var l=a(2261),s=a(4373);const o="https://cafenomad.tw/api/v1.2/cafes/",n="https://api.allorigins.win/raw?url=",r=e=>{const t=`${o}${e}`;return`${n}${encodeURIComponent(t)}`};var i=r;const c=Date.now();function d(e){const t=localStorage.getItem(e),a=18e5;if(t)try{const l=JSON.parse(t);if(l.timestamp&&c-l.timestamp<a)return l.data;l.timestamp&&c-l.timestamp>=a&&(localStorage.removeItem(e),console.log("localStorage 已過期(超過30分鐘)，已清除"))}catch(l){localStorage.removeItem(e),console.error("localStorage 資料錯誤",l)}return!1}function u(e,t){localStorage.setItem(e,JSON.stringify({data:t,timestamp:c}))}const v=(0,l.nY)("cafes",{state:()=>({cafesByCity:{},loadingCities:{},errors:{},preloadPromises:{}}),actions:{async getCafesByCity(e){const t=`cafe_data_${e}`,a=d(t);if(a)return this.cafesByCity[e]=a,console.log("從 localStorage 獲取資料",e,a.length),a;const l=i(e);this.loadingCities[e]=!0;try{const a=await s.A.get(l),o=a.data;return this.cafesByCity[e]=o,this.errors[e]=null,u(t,o),console.log("選擇城市的咖啡店資料已更新",e,o.length),o}catch(o){throw this.errors[e]=o.message||"取得資料失敗",console.error("API 請求失敗:",e,o),o}finally{this.loadingCities[e]=!1}},preloadCity(e){return this.preloadPromises[e]||(this.preloadPromises[e]=this.getCafesByCity(e).catch((t=>{console.error(`預加載 ${e} 資料失敗:`,t)}))),this.preloadPromises[e]},preloadMultipleCities(e=[]){let t=Promise.resolve();return e.forEach((e=>{t=t.then((()=>this.preloadCity(e)))})),t}}});var p=v},2136:function(e,t,a){a.d(t,{A:function(){return u}});var l=a(6768),s=a(4232);const o={key:0,class:"modal-overlay"},n={class:"modal-type"},r={class:"modal-message light-bold-text"};var i={__name:"ModalBox",props:{visible:Boolean,message:String,type:{type:String,default:"success"}},emits:["close"],setup(e,{emit:t}){const a=e,i=(0,l.EW)((()=>"success"===a.type?"modal-text-green":"modal-text-red")),c=(0,l.EW)((()=>"success"===a.type?"成功！":"錯誤！")),d=t,u=()=>{d("close")};return(t,a)=>e.visible?((0,l.uX)(),(0,l.CE)("div",o,[(0,l.Lk)("div",{class:(0,s.C4)(["modal-box",i.value])},[(0,l.Lk)("p",n,(0,s.v_)(c.value),1),(0,l.Lk)("p",r,(0,s.v_)(e.message),1),(0,l.Lk)("button",{class:"button click-color-light",onClick:u},"確定")],2)])):(0,l.Q3)("",!0)}},c=a(1241);const d=(0,c.A)(i,[["__scopeId","data-v-584854f8"]]);var u=d},6176:function(e,t,a){a.r(t),a.d(t,{default:function(){return B}});var l=a(6768),s=a(4232),o=a(5130),n=a.p+"img/teaAndBook.0b869572.png";const r={class:"screen-center"},i={class:"container"},c=["value"],d={key:0,class:"table-border"},u=["id"],v={class:"table-td border-b"},p={class:"table-td border-b"},b={class:"table-td border-b"},h=["href"],g={class:"table-td border-b"},m={class:"checkout"},y=["disabled"];function f(e,t,a,f,k,C){const L=(0,l.g2)("LoadingOverlay"),S=(0,l.g2)("ModalBox");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(L,{active:f.isLoading,color:"#79716b"},null,8,["active"]),(0,l.Lk)("div",r,[t[10]||(t[10]=(0,l.Lk)("p",{class:"slogan"},"尋找你的咖啡靈魂",-1)),(0,l.Lk)("div",i,[t[3]||(t[3]=(0,l.Lk)("label",{for:"dropdown",class:"label"},"選擇城市：",-1)),(0,l.bo)((0,l.Lk)("select",{id:"dropdown","onUpdate:modelValue":t[0]||(t[0]=e=>f.selectedCity=e),class:"select"},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(f.options,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.value,value:e.value},(0,s.v_)(e.label),9,c)))),128))],512),[[o.u1,f.selectedCity]])]),(0,l.bF)(o.eB,null,{default:(0,l.k6)((()=>[f.isDestinyDone?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("table",{class:"table-all",id:`item-${f.selectedShop.id}`},[(0,l.Lk)("tr",null,[t[4]||(t[4]=(0,l.Lk)("th",{class:"table-td border-b border-r w-25 text-nowrap"},"店家名稱",-1)),(0,l.Lk)("td",v,(0,s.v_)(f.selectedShop.name||"無"),1)]),(0,l.Lk)("tr",null,[t[5]||(t[5]=(0,l.Lk)("th",{class:"table-td border-b border-r w-25 text-nowrap"},"城市",-1)),(0,l.Lk)("td",p,(0,s.v_)(f.selectedShop.city||"無"),1)]),(0,l.Lk)("tr",null,[t[8]||(t[8]=(0,l.Lk)("th",{class:"table-td border-b border-r"},"地址",-1)),(0,l.Lk)("td",b,[(0,l.Lk)("a",{href:`https://www.google.com/maps/search/${encodeURIComponent(f.selectedShop.name)}`,target:"_blank",rel:"noreferrer noopener",class:"underline"},[(0,l.eW)((0,s.v_)(f.selectedShop.address||"無"),1),t[6]||(t[6]=(0,l.Lk)("br",null,null,-1)),t[7]||(t[7]=(0,l.eW)(" (前往 Google 地圖) "))],8,h)])]),(0,l.Lk)("tr",null,[t[9]||(t[9]=(0,l.Lk)("th",{class:"table-td border-b border-r"},"營業時間",-1)),(0,l.Lk)("td",g,(0,s.v_)(f.selectedShop.open_time||"無"),1)])],8,u),(0,l.Lk)("div",m,[(0,l.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>f.checkout&&f.checkout(...e)),class:"button click-color-mid"}," 點擊收藏到你的口袋名單 ")])])):(0,l.Q3)("",!0)])),_:1}),t[11]||(t[11]=(0,l.Lk)("p",{class:"text-xs text-stone-400"}," 營業時間可能不同，出發前請至官方網站確認 ",-1)),(0,l.Lk)("button",{class:"btn click-color-light",onClick:t[2]||(t[2]=(0,o.D$)(((...e)=>f.getDestinyShop&&f.getDestinyShop(...e)),["prevent"])),disabled:f.isDestiny||!f.selectedCity},(0,s.v_)(f.isDestiny?"抽籤中...":"點擊進行抽籤"),9,y),t[12]||(t[12]=(0,l.Lk)("img",{class:"image",src:n,alt:"teaAndBook"},null,-1))]),(0,l.bF)(S,{visible:f.showModal,message:f.modalMessage,type:f.modalType,onClose:f.closeModal},null,8,["visible","message","type","onClose"])],64)}a(4114),a(8992),a(7550);var k=a(144),C=a(7258),L=a(2136),S=a(5785),w=a(3998),_={name:"DestinyView",components:{ModalBox:L.A},setup(){const e=(0,k.Kh)([{value:"",label:"請先選擇城市"},{value:"Keelung",label:"基隆"},{value:"taipei",label:"台北"},{value:"taoyuan",label:"桃園"},{value:"hsinchu",label:"新竹"},{value:"miaoli",label:"苗栗"},{value:"taichung",label:"台中"},{value:"changhua",label:"彰化"},{value:"nantou",label:"南投"},{value:"yunlin",label:"雲林"},{value:"chiayi",label:"嘉義"},{value:"tainan",label:"台南"},{value:"kaohsiung",label:"高雄"},{value:"pingtung",label:"屏東"},{value:"yilan",label:"宜蘭"},{value:"hualien",label:"花蓮"},{value:"taitung",label:"台東"},{value:"penghu",label:"澎湖"}]),t=(0,w.A)(),a=(0,k.KR)(""),s=(0,l.EW)((()=>t.loadingCities[a.value])),o=(0,l.EW)((()=>t.cafesByCity[a.value]||[])),{showModal:n,modalMessage:r,modalType:i,openModal:c,closeModal:d}=(0,S.A)(),{selectedShop:u,isDestiny:v,isDestinyDone:p,getDestinyShop:b}=(0,C.A)(o);(0,l.wB)(a,(async e=>{if(e)try{await t.getCafesByCity(e)}catch(a){c("取得資料失敗，請重新整理後再試一次，謝謝！","error")}else c("請選擇一個城市！","error")}));const h=()=>{const e=JSON.parse(localStorage.getItem("savedCafes")||"[]"),t=e.some((e=>e.id===u.value.id));if(t)return void c("此咖啡店已在你的口袋名單中！","error");const a={id:u.value.id,name:u.value.name,city:u.value.city,address:u.value.address,open_time:u.value.open_time};e.push(a),localStorage.setItem("savedCafes",JSON.stringify(e)),c("已成功收藏到你的口袋名單！","success")};return{selectedCity:a,options:e,selectedShop:u,allCafes:o,isLoading:s,isDestiny:v,isDestinyDone:p,getDestinyShop:b,showModal:n,closeModal:d,modalMessage:r,modalType:i,checkout:h}}},D=a(1241);const M=(0,D.A)(_,[["render",f],["__scopeId","data-v-ba0b66ca"]]);var B=M}}]);