"use strict";(self["webpackChunkcafe_today"]=self["webpackChunkcafe_today"]||[]).push([[365],{5785:function(e,t,a){a.d(t,{A:function(){return o}});var s=a(144);function o(){const e=(0,s.KR)(!1),t=(0,s.KR)(""),a=(0,s.KR)("success"),o=(s,o="success")=>{t.value=s,a.value=o,e.value=!0},l=()=>{e.value=!1};return{showModal:e,modalMessage:t,modalType:a,openModal:o,closeModal:l}}},6994:function(e,t,a){a.d(t,{A:function(){return l}});var s=a(6768),o=a(144);function l(e,t=5){const a=(0,s.EW)((()=>e.value.length)),l=(0,o.KR)(1),n=(0,o.KR)(t),r=(0,s.EW)((()=>{if(0===a.value)return[];const t=(l.value-1)*n.value,s=Math.min(t+n.value,a.value);return e.value.slice(t,s)}));(0,s.wB)(a,(e=>{if(e>0){const t=(l.value-1)*n.value;t>=e&&(l.value=1)}}));const i=e=>{l.value=e,window.scrollTo({top:0,behavior:"smooth"})},c=()=>{l.value=1};return{totalItemsNumber:a,currentPage:l,itemsPerPage:n,currentPageItems:r,getPageChange:i,resetPage:c}}},3998:function(e,t,a){a.d(t,{A:function(){return v}});a(8992),a(3949);var s=a(2261),o=a(4373);const l="https://cafenomad.tw/api/v1.2/cafes/",n="https://api.allorigins.win/raw?url=",r=e=>{const t=`${l}${e}`;return`${n}${encodeURIComponent(t)}`};var i=r;const c=Date.now();function u(e){const t=localStorage.getItem(e),a=18e5;if(t)try{const s=JSON.parse(t);if(s.timestamp&&c-s.timestamp<a)return s.data;s.timestamp&&c-s.timestamp>=a&&(localStorage.removeItem(e),console.log("localStorage 已過期(超過30分鐘)，已清除"))}catch(s){localStorage.removeItem(e),console.error("localStorage 資料錯誤",s)}return!1}function d(e,t){localStorage.setItem(e,JSON.stringify({data:t,timestamp:c}))}const m=(0,s.nY)("cafes",{state:()=>({cafesByCity:{},loadingCities:{},errors:{},preloadPromises:{}}),actions:{async getCafesByCity(e){const t=`cafe_data_${e}`,a=u(t);if(a)return this.cafesByCity[e]=a,console.log("從 localStorage 獲取資料",e,a.length),a;const s=i(e);this.loadingCities[e]=!0;try{const a=await o.A.get(s),l=a.data;return this.cafesByCity[e]=l,this.errors[e]=null,d(t,l),console.log("選擇城市的咖啡店資料已更新",e,l.length),l}catch(l){throw this.errors[e]=l.message||"取得資料失敗",console.error("API 請求失敗:",e,l),l}finally{this.loadingCities[e]=!1}},preloadCity(e){return this.preloadPromises[e]||(this.preloadPromises[e]=this.getCafesByCity(e).catch((t=>{console.error(`預加載 ${e} 資料失敗:`,t)}))),this.preloadPromises[e]},preloadMultipleCities(e=[]){let t=Promise.resolve();return e.forEach((e=>{t=t.then((()=>this.preloadCity(e)))})),t}}});var v=m},9737:function(e,t,a){a(4114),a(8992),a(4520),a(2577),a(8872),a(7550);var s=a(2261);const o=(0,s.nY)("save",{state:()=>({items:[],selectedItems:[]}),getters:{totalAmount:e=>e.items.reduce(((e,t)=>e+t.address),0),itemCount:e=>e.items.length},actions:{addToSave(e){const t=JSON.parse(localStorage.getItem("savedCafes")||"[]"),a=t.some((t=>t.id===e.id));if(a)return"isAlreadySavedInStorage";const s=this.items.find((t=>t.id===e.id));if(s){if(s)return"existingItem"}else this.items.push({id:e.id,name:e.name,city:e.city,address:e.address,open_time:e.open_time});return!0},removeFromSave(e){this.items=this.items.filter((t=>t.id!==e)),this.selectedItems=this.selectedItems.filter((t=>t!==e))},toggleSelectItem(e){const t=this.selectedItems.indexOf(e);-1===t?this.selectedItems.push(e):this.selectedItems.splice(t,1)},removeSelectedItems(){this.items=this.items.filter((e=>!this.selectedItems.includes(e.id))),this.selectedItems=[]},clearSave(){this.items=[],this.selectedItems=[]},checkout(){let e=JSON.parse(localStorage.getItem("savedCafes")||"[]");e=[...e,...this.items],localStorage.setItem("savedCafes",JSON.stringify(e))}}});t.A=o},2136:function(e,t,a){a.d(t,{A:function(){return d}});var s=a(6768),o=a(4232);const l={key:0,class:"modal-overlay"},n={class:"modal-type"},r={class:"modal-message light-bold-text"};var i={__name:"ModalBox",props:{visible:Boolean,message:String,type:{type:String,default:"success"}},emits:["close"],setup(e,{emit:t}){const a=e,i=(0,s.EW)((()=>"success"===a.type?"modal-text-green":"modal-text-red")),c=(0,s.EW)((()=>"success"===a.type?"成功！":"錯誤！")),u=t,d=()=>{u("close")};return(t,a)=>e.visible?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",{class:(0,o.C4)(["modal-box",i.value])},[(0,s.Lk)("p",n,(0,o.v_)(c.value),1),(0,s.Lk)("p",r,(0,o.v_)(e.message),1),(0,s.Lk)("button",{class:"button click-color-light",onClick:d},"確定")],2)])):(0,s.Q3)("",!0)}},c=a(1241);const u=(0,c.A)(i,[["__scopeId","data-v-584854f8"]]);var d=u},1969:function(e,t,a){a.d(t,{A:function(){return h}});a(4114);var s=a(6768),o=a(4232);const l={class:"pagination-container"},n={class:"pagination-bg"},r=["disabled"],i={class:"flex space-x-1"},c=["onClick"],u=["disabled"],d={class:"text-center light-bold-text-xs"},m={key:0},v={key:1};var g={__name:"PageComponent",props:{currentPage:{type:Number,required:!0,default:1},totalItems:{type:Number,required:!0,default:0},itemsPerPage:{type:Number,default:24}},emits:["update:page"],setup(e,{emit:t}){const a=e,g=(0,s.EW)((()=>Math.max(1,Math.ceil(a.totalItems/a.itemsPerPage)))),p=(0,s.EW)((()=>0===a.totalItems?0:Math.min((a.currentPage-1)*a.itemsPerPage+1,a.totalItems))),f=(0,s.EW)((()=>Math.min(a.currentPage*a.itemsPerPage,a.totalItems))),h=(0,s.EW)((()=>{const e=g.value||1;if(e<=0)return[1];const t=[],s=Math.min(5,e);if(e<=s)for(let a=1;a<=e;a+=1)t.push(a);else{const o=Math.floor(s/2);let l=Math.max(1,a.currentPage-o);const n=Math.min(e,l+s-1);n-l+1<s&&(l=Math.max(1,n-s+1));for(let e=l;e<=n;e+=1)t.push(e)}return t})),C=t,y=e=>{e<1||e>g.value||C("update:page",e)};return(t,a)=>((0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",n,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=t=>y(e.currentPage-1)),disabled:e.currentPage<=1,class:(0,o.C4)(["pagination-button",{"not-allowed":e.currentPage<=1}])}," 上一頁 ",10,r),(0,s.Lk)("div",i,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value,(t=>((0,s.uX)(),(0,s.CE)("button",{key:t,onClick:e=>y(t),class:(0,o.C4)(["pagination-number",{"currentPage-bg":t===e.currentPage}])},(0,o.v_)(t),11,c)))),128))]),(0,s.Lk)("button",{onClick:a[1]||(a[1]=t=>y(e.currentPage+1)),disabled:e.currentPage>=g.value,class:(0,o.C4)(["pagination-button",{"not-allowed":e.currentPage>=g.value}])}," 下一頁 ",10,u)]),(0,s.Lk)("div",d,[e.totalItems>0?((0,s.uX)(),(0,s.CE)("span",m," 顯示 "+(0,o.v_)(e.totalItems)+" 筆資料中的第 "+(0,o.v_)(p.value)+" ~ "+(0,o.v_)(f.value)+" 筆 ",1)):((0,s.uX)(),(0,s.CE)("span",v,"沒有資料"))])]))}},p=a(1241);const f=(0,p.A)(g,[["__scopeId","data-v-1a36ca16"]]);var h=f},5365:function(e,t,a){a.r(t),a.d(t,{default:function(){return K}});var s=a(6768),o=(a(8992),a(4520),a(5130)),l=a(4232),n=a(144),r=a(3998),i=a(6994),c=a(9737),u=a(2136),d=a(5785);const m={class:"card"},v={class:"card-container"},g={class:"dark-text"},p={class:"light-bold-text-xs"},f={class:"dark-text-xs"},h=["disabled"];var C={__name:"CafeItem",props:{cafe:{type:Object,required:!0}},setup(e){const{showModal:t,modalMessage:a,modalType:o,openModal:r,closeModal:i}=(0,d.A)(),C=e,y=(0,c.A)(),b=(0,s.EW)((()=>""!==C.cafe.open_time)),k=(0,s.EW)((()=>{switch(C.cafe.open_time){case"":return"text-gray-500 font-medium text-xs";default:return"text-stone-400 font-medium text-xs"}})),I=()=>{if(b.value){const e=y.addToSave(C.cafe);"isAlreadySavedInStorage"===e?r("此咖啡店已在你的口袋名單中！","error"):"existingItem"===e?r("此咖啡店已在待收藏清單中！","error"):!0===e&&r("成功加入待收藏清單！","success")}};return(r,c)=>((0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",m,[(0,s.Lk)("div",v,[(0,s.Lk)("h3",g,(0,l.v_)(e.cafe.name),1),(0,s.Lk)("span",p,(0,l.v_)(e.cafe.city),1),(0,s.Lk)("span",f,(0,l.v_)(e.cafe.address),1),(0,s.Lk)("span",{class:(0,l.C4)(k.value)},(0,l.v_)(e.cafe.open_time||"無"),3),(0,s.Lk)("button",{disabled:""===e.cafe.open_time,onClick:I,class:(0,l.C4)(b.value?"button click-color-mid":"button not-allowed")},(0,l.v_)(b.value?"加入待收藏清單":"沒有營業時間"),11,h)])]),(0,s.bF)(u.A,{visible:(0,n.R1)(t),message:(0,n.R1)(a),type:(0,n.R1)(o),onClose:(0,n.R1)(i)},null,8,["visible","message","type","onClose"])],64))}},y=a(1241);const b=(0,y.A)(C,[["__scopeId","data-v-20de844a"]]);var k=b,I=a(1969);const _={class:"input-label light-bold-text"},P={key:0},x={key:1,class:"error"},E={key:2},S={key:0,class:"no-data"},L={key:1},w={class:"cafe-item-card"};var A={__name:"CafeList",setup(e){const t=(0,r.A)(),a=(0,n.KR)("taichung"),c=(0,s.EW)((()=>t.loadingCities[a.value])),u=(0,s.EW)((()=>t.errors[a.value])),d=(0,s.EW)((()=>t.cafesByCity[a.value]||[])),m=(0,n.KR)(""),v=(0,s.EW)((()=>{if(!m.value.trim())return d.value;const e=m.value.toLowerCase().trim();return d.value.filter((t=>t.name.toLowerCase().includes(e)))})),{totalItemsNumber:g,currentPage:p,itemsPerPage:f,currentPageItems:h,getPageChange:C,resetPage:y}=(0,i.A)(v,24);return(0,s.wB)(m,(()=>{y()})),(0,s.KC)((async()=>{try{await t.getCafesByCity(a.value),console.log(`取得 ${a.value} 咖啡店資料，共 ${g.value} 筆`)}catch(e){console.error(`取得 ${a.value} 咖啡店資料時發生錯誤:`,e)}})),(e,t)=>{const a=(0,s.g2)("LoadingOverlay");return(0,s.uX)(),(0,s.CE)("div",null,[t[3]||(t[3]=(0,s.Lk)("h2",{class:"title"},"台中咖啡店列表",-1)),(0,s.Lk)("div",_,[t[2]||(t[2]=(0,s.Lk)("label",{for:"search"},"搜尋店名",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"input-text",id:"search","onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e),placeholder:"search",onInput:t[1]||(t[1]=(...t)=>e.handleSearch&&e.handleSearch(...t))},null,544),[[o.Jo,m.value]])]),(0,s.bF)(o.eB,null,{default:(0,s.k6)((()=>[c.value?((0,s.uX)(),(0,s.CE)("div",P,[(0,s.bF)(a,{active:c.value,color:"#79716b"},null,8,["active"])])):u.value?((0,s.uX)(),(0,s.CE)("div",x,(0,l.v_)(u.value),1)):((0,s.uX)(),(0,s.CE)("div",E,[0===(0,n.R1)(g)?((0,s.uX)(),(0,s.CE)("div",S,"沒有找到咖啡店資料")):((0,s.uX)(),(0,s.CE)("div",L,[(0,s.Lk)("div",w,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)((0,n.R1)(h),(e=>((0,s.uX)(),(0,s.Wv)(k,{key:e.id,cafe:e},null,8,["cafe"])))),128))]),(0,s.bF)(I.A,{"current-page":(0,n.R1)(p),"total-items":(0,n.R1)(g),"items-per-page":(0,n.R1)(f),"onUpdate:page":(0,n.R1)(C)},null,8,["current-page","total-items","items-per-page","onUpdate:page"])]))]))])),_:1})])}}};const M=(0,y.A)(A,[["__scopeId","data-v-74d8e0eb"]]);var R=M;const X={class:"min-h-[82vh]"};var W={__name:"ListTaichungView",setup(e){return(0,s.n)((()=>{console.log("ListTaichungView activated")})),(0,s.Y4)((()=>{console.log("ListTaichungView deactivated")})),(e,t)=>((0,s.uX)(),(0,s.CE)("div",X,[(0,s.bF)(R)]))}};const B=W;var K=B}}]);